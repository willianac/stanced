<app-header></app-header>
<div class="max-w-7xl block mt-24 mx-auto border-2 shadow-xl">
    <div class="flex flex-wrap gap-12 w-full">
        <div *ngIf="carinfo" class="p-4">
            <h2 class="font-display font-semibold tracking-wide text-3xl border-b-2 pb-3 mb-4">{{carinfo.title}}</h2>
            <div class="flex flex-col justify-center max-w-2xl">
                <div class="flex flex-col mb-6">
                    <app-card-photo      
                        [url]="carinfo.url"
                        [id]="carinfo.id"
                    ></app-card-photo>
                    <small class="text-sm font-medium text-zinc-600 mb-4">Curtido por {{carinfo.likes}} pessoas</small>
                    <div class="flex justify-between items-center">
                        <div (click)="like(carinfo.id)" (click)="carinfo.shouldHeartBeFilled = true" class="flex items-center gap-x-2 group cursor-pointer">
                            <i *ngIf="carinfo.didUserLiked || carinfo.shouldHeartBeFilled; else userDidntLikedYet" class="pi pi-heart-fill text-xl font-semibold text-red-500"></i>
                            
                            <ng-template #userDidntLikedYet>
                                <i class="pi pi-heart text-xl font-semibold text-red-zinc-800 group-hover:text-red-500"></i>
                            </ng-template>

                            <span class="font-semibold text-lg text-zinc-800 group-hover:text-red-500">Curtir</span>
                        </div>
                        <div class="flex gap-x-3">
                            <svg (click)="saveImage()" class="text-zinc-800 hover:text-bgblue transition cursor-pointer" xmlns="http://www.w3.org/2000/svg" height="28" viewBox="0 -960 960 960" width="28"><path fill="currentColor" d="M200-120v-640q0-33 23.5-56.5T280-840h400q33 0 56.5 23.5T760-760v640L480-240 200-120Zm80-122 200-86 200 86v-518H280v518Zm0-518h400-400Z"/></svg>
                            <svg *ngIf="carinfo.userid === userid" (click)="deleteImage()" class="text-zinc-800 hover:text-red-700 cursor-pointer transition" xmlns="http://www.w3.org/2000/svg" height="28" viewBox="0 -960 960 960" width="28"><path fill="currentColor" d="M280-120q-33 0-56.5-23.5T200-200v-520h-40v-80h200v-40h240v40h200v80h-40v520q0 33-23.5 56.5T680-120H280Zm400-600H280v520h400v-520ZM360-280h80v-360h-80v360Zm160 0h80v-360h-80v360ZM280-720v520-520Z"/></svg>
                        </div>
                    </div>
                </div>
                <div>
                    <div class="flex items-center gap-3">
                        <i class="pi pi-user bg-blue-400 rounded-full p-2"></i>
                        <span class="font-bold text-lg">{{carinfo.user_name}}</span>
                        <span class="text-xs text-zinc-500">{{carinfo.createdAt | date}}</span>
                    </div>
                    <p class="mt-4 text-zinc-700">{{carinfo.description}}</p>
                </div>
            </div>
        </div>
        <div class="flex-1">
            <div *ngIf="commentList | async as comments; else noCommentText" class="p-5 overflow-y-auto max-h-[40rem]">
                <h2 class="font-bold text-xl mb-5">Comentários</h2>
                <div *ngFor="let comment of comments" class="mb-3">
                    <div class="flex flex-col relative py-3 px-5 rounded-sm bg-zinc-500 bg-opacity-10">
                        <span class="font-semibold text-zinc-800">{{comment.username}}</span>
                        <p class="text-sm text-zinc-800">{{comment.comment}}</p>
                        <span class="text-xs text-zinc-500 absolute left-28 top-3">{{comment.createdAt | date}}</span>       
                    </div>
                </div>
            </div>
            <form (ngSubmit)="sendComment()" class="mt-4 flex gap-2 w-full px-5">
                <input 
                    [(ngModel)]="commentInput"
                    type="text" 
                    placeholder="Digite seu comentario" 
                    class="border-2 h-11 rounded-sm font-normal text-base indent-4 bg-zinc-100 transition duration-300 focus:border-bgblue outline-none w-full"
                    name="comment"
                >   
                <button class="bg-bgblue px-4 rounded-sm font-medium text-white hover:bg-indigo-800 transition">Enviar</button>
            </form>
        </div>
    </div>
</div>

<ng-template #noCommentText>
    <p class="text-base text-center">Sem comentários ainda</p>
</ng-template>